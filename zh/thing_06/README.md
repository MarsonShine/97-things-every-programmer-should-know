# 重构之前

每个程序员都会有需要重构现有代码的时候。但在此之前，请考虑以下几点，因为这可以为您和他人节省大量时间（和痛苦）：

- *重构的最佳方法是从评估现有的代码库和针对这些代码编写的测试开始。*我们都认为自己可以做得比现有系统更好......直到我们最终得到的东西并不比以前的更好，甚至更糟，因为我们没能从现有系统的错误中吸取教训。

- *避免重写一切的诱惑尽可能多地重复使用代码是上策。*无论代码有多难看，它都已经过测试、审查等。扔掉旧代码，尤其是生产中的旧代码，意味着你扔掉了数月（或数年）经过测试、实战磨练的代码，而这些代码中可能有你不知道的变通方法和错误修复。如果不考虑这一点，您编写的新代码最终可能会出现与旧代码中已修复的相同的神秘错误。这将浪费大量的时间、精力和多年积累的知识。

- *多次增量更改胜过一次大规模更改。*通过测试等反馈，增量更改可以更容易地衡量对系统的影响。在进行变更后，看到上百次测试失败可不是件好玩的事。这会导致挫败感和压力，进而做出错误的决定。几次测试失败很容易处理，而且提供了一种更易于管理的方法。

- *在每次迭代后，确保现有测试通过是很重要的。* 如果现有测试不足以覆盖你所做的更改，则添加新的测试。不要不加考虑地丢弃旧代码中的测试。从表面上看，有些测试似乎并不适用于您的新设计，但如果能深入研究一下添加该测试的原因，那就非常值得了。

- *个人喜好和自我意识不应成为阻碍。*如果东西没坏，为什么要修？代码的风格或结构不符合你的个人偏好并不能成为重构的理由。认为自己能比前任程序员做得更好也不是合理的理由。

- *重构的最糟糕理由之一就是当前的代码远远落后于当今所有的先进技术*，而我们认为新的语言或框架可以更优雅地完成工作。除非成本效益分析表明，新的语言或框架能在功能、可维护性或生产率方面带来重大改进，否则最好还是保持原样。

- *请记住，人都会犯错。*重构并不总能保证新代码会更好，甚至不如之前的尝试。我曾目睹并参与过几次失败的重构尝试。这并不美好，但这也很常见。

作者：[Rajith Attapattu](http://programmer.97things.oreilly.com/wiki/index.php/Rajith_Attapattu)