# 小心共享

这是我在公司的第一个项目。我刚刚完成学业，急于证明自己的能力，每天都加班到很晚，检查现有的代码。在完成我的第一个功能时，我格外小心，把我学到的所有知识都用上了——注释、日志、尽可能把共享代码拉到库里等等。代码审查时让我大吃一惊——重用代码不被允许！

怎么会这样？在大学期间，重用一直被视为高质量软件工程的缩影。我读过的所有文章、教科书、经验丰富的软件专家都教过我。难道这一切都错了吗？

事实证明，我缺少了一些关键的东西。

上下文。

事实上，系统中两个完全不同的部分以相同的方式执行某些逻辑，并没有我想象的那么重要。在我调出这些共享代码库之前，这些部分并不相互依赖。每个部分都可以独立发展。每个部分都可以改变其逻辑，以适应系统不断变化的业务环境的需要。这四行相似的代码是偶然的——一种时间上的反常，是一种巧合。直到我的出现。

我创建的共享代码库将每只脚的鞋带绑在了一起。如果不与另一个业务领域同步，这个业务领域就无法前进。过去，这些独立功能的维护成本可以忽略不计，但共用库需要的测试量却要高出一个数量级。

虽然我减少了系统中代码的绝对行数，但却增加了依赖关系的数量。这些依赖关系的上下文至关重要——如果这些依赖关系是本地化的，那么它可能是合理的，并具有一定的积极价值。当这些依赖关系没有受到控制时，它们的触角纠缠于系统更大的问题，尽管代码本身看起来没什么问题。

这些错误很隐蔽，因为它们的核心听起来是个好主意。在正确的情况下，这些技术是有价值的。在错误的情况下，它们增加的是成本而不是价值。当我进入一个现有的代码库，却不知道各个部分的使用环境时，我现在对共享的内容会更加谨慎。

小心共享。检查上下文。只有这样，才能继续。

作者：[Udi Dahan](http://programmer.97things.oreilly.com/wiki/index.php/Udi_Dahan)