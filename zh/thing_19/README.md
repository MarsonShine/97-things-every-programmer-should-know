# 便捷性不是一种“借口”

关于设计良好API的重要性和挑战已经说了很多。第一次就把它搞对很难，而且后来要修改更加困难。有点像抚养孩子。大多数有经验的程序员已经学到，一个好的 API 应该具有一致的抽象层次，表现出一致性和对称性，并形成一个富有表现力的语言词汇。然而，知道这些指导原则并不会自动转化为适当的行为。吃甜食对你身体不好。

我不想高高在上地说教，我想批评一个特定的API设计“策略”，这是我一再遇到的：便捷性的争论。它通常以以下一种“洞见”开始：

- 我不希望其他类必须分别调用两个方法才能完成这一件事。
- 如果它和这个方法几乎一样，为什么我要再写一个方法呢？我只需添加一个简单的开关。
- 瞧，这很容易：如果第二个字符串参数以“.txt”结尾，方法就会自动假定第一个参数是文件名，所以我实际上不需要两个方法。

虽然出发点是好的，但是这样的争论容易降低使用API的代码的可读性。像这样的方法调用：

```
parser.processNodes(text, false);
```

如果不知道具体实现或至少查阅文档，这几乎毫无意义。这种方法很可能是为了实现者方便而设计的，而不是为了调用者方便——“我不想让调用者必须做两次调用”被诠释为“我不想编写两个单独方法”。如果方便性旨在解决繁琐、笨拙或尴尬等问题，那么并没有什么根本问题。然而，如果我们更加仔细地思考，我们就会发现，这些症状的解决办法是效率、一致性和优雅，而不仅仅是便捷性。API 应该隐藏底层复杂性，所以我们可以合理地期望良好的 API 设计需要一些努力。与其编写一个单一的大方法，倒不如考虑一下，使用它会更容易吗？

将 API 比作一种语言的隐喻可以指导我们在这些情况下做出更好的设计决策。API 应该提供一种富有表现力的语言，为上面的一层提供足够的词汇来提出和回答有用的问题。这并不意味着它应该为可能值得提问的每个问题提供一个方法或动词。丰富的词汇允许我们表达含义上的微妙差异。例如，我们更喜欢说“run”而不是“walk(true)”，即使它们可能被视为本质上相同的操作，只是以不同的速度执行。一套一致和经过深思熟虑的 API 词汇使得上面的代码具有表现力和易于理解。更重要的是，可组合的词汇允许其他程序员以您可能未曾预料到的方式使用 API——这对于 API 的用户确实非常方便！下一次，当您想把几件事情合并到一个 API 方法中时，请记住英语中并没有“MakeUpYourRoomBeQuietAndDoYourHomeWork”（让您的房间更安静，让您的工作更轻松）这样的单词，尽管对于这样一个经常被请求的操作来说，这个单词似乎真的很方便。

作者：[Gregor Hohpe](http://programmer.97things.oreilly.com/wiki/index.php/Gregor_Hohpe)

