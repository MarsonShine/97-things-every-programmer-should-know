# 不要重复自己

在所有编程原则中，“不要重复自己”（DRY）可能是最基本的原则之一。安迪-亨特（Andy Hunt）和戴夫-托马斯（Dave Thomas）在《务实的程序员》（*The Pragmatic Programmer*）一书中提出了这一原则，它也是许多其他著名软件开发最佳实践和设计模式的基础。开发人员如果学会识别重复，并了解如何通过适当的实践和适当的抽象来消除重复，就能比那些不断用不必要的重复来感染应用程序的人编写出更简洁的代码。

重复就是浪费
---

应用程序中的每一行代码都必须得到维护，这也是未来出现错误的潜在根源。不必要的重复会使代码库变得臃肿，从而增加出现错误的机会，并意外增加系统的复杂性。重复给系统带来的臃肿也会让开发人员更难完全理解整个系统，或者无法确定在一个地方做出的更改是否也需要在其他地方做出，从而重复了他们正在处理的逻辑。DRY 要求“每一项知识在系统中都必须有一个单一、明确、权威的表示”。

流程中的重复需要自动化
---

软件开发中的许多流程都是重复的，很容易实现自动化。DRY 原则适用于这些情况以及应用程序的源代码。手动测试速度慢、易出错且难以重复，因此应尽可能使用自动测试套件。手动集成软件既耗时又容易出错，因此应尽可能频繁地运行构建流程，最好是每次签入时都运行。只要存在可以自动化的痛苦手动流程，就应将其自动化和标准化。这样做的目的是确保只有一种方法可以完成任务，而且尽可能无痛。

逻辑重复需要抽象
---

逻辑中的重复有多种形式。复制粘贴*if-then*或*switch-case*逻辑是最容易发现和纠正的。许多设计模式的明确目标就是减少或消除应用程序中逻辑的重复。如果一个对象在使用前通常需要做几件事，那么可以通过抽象工厂或工厂方法来实现。如果一个对象的行为有许多可能的变化，则可以使用策略模式来注入这些行为，而不是使用大量的 *if-then* 结构。事实上，设计模式的制定本身就是为了减少解决常见问题和讨论这些解决方案所需的重复劳动。此外，DRY 还可应用于数据库模式等结构，从而实现规范化。

原则问题
---

其他软件原则也与 DRY 有关。仅适用于代码功能行为的“一次且仅一次”原则可视为 DRY 的一个子集。开放/封闭原则指出 “软件实体应开放用于扩展，但封闭用于修改”，只有在遵循 DRY 原则的情况下，该原则才能在实践中发挥作用。同样，众所周知的“单一责任原则”（Single Responsibility Principle）要求一个类“只有一个改变的理由”，这也依赖于 DRY。

在结构、逻辑、流程和功能方面遵循 DRY 原则，可为软件开发人员提供基本指导，有助于创建更简单、可维护性更强、质量更高的应用程序。虽然在某些情况下，为了满足性能或其他要求，重复是必要的（如数据库中的数据去规范化），但只有在直接解决实际问题而非想象中的问题时，才应使用重复。

作者：[Steve Smith](http://programmer.97things.oreilly.com/wiki/index.php/Steve_Smith)