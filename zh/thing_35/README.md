# 应用程序接口设计的黄金法则

应用程序接口（API）的设计非常困难，尤其是在大型应用程序接口中。如果你要设计的 API 将拥有成百上千的用户，你就必须考虑将来如何更改它，以及你的更改是否会破坏客户端代码。除此之外，您还必须考虑 API 用户对您的影响。如果您的某个 API 类在内部使用了自己的某个方法，您必须记住，用户可以子类化您的类并覆盖它，而这可能会带来灾难性的后果。你将无法更改该方法，因为有些用户赋予了它不同的含义。你未来的内部实现选择将任由用户摆布。

应用程序接口开发人员解决这个问题的方法多种多样，但最简单的方法就是锁定应用程序接口。如果您使用的是 Java，您可能会倾向于将大部分类和方法设置为 final。在 C# 中，您可能会将类和方法密封起来。无论您使用哪种语言，您都可能会倾向于通过单例或使用静态工厂方法来展示您的 API，这样您就可以保护它不被人覆盖行为和使用您的代码，而这些行为和代码可能会限制您以后的选择。这一切看似合理，但真的如此吗？

在过去的十年中，我们逐渐意识到单元测试是实践中极其重要的一部分，但这一教训并没有完全渗透到整个行业。证据就在我们身边。随便拿一个使用第三方 API 的未经测试的类，试着为它编写单元测试。大多数情况下，你都会遇到麻烦。你会发现使用 API 的代码就像胶水一样粘在上面。你无法冒充 API 类，从而感知代码与它们的交互，或提供返回值用于测试。

随着时间的推移，这种情况会越来越好，但前提是我们在设计应用程序接口时，必须将测试视为一种真正的用例。不幸的是，这比仅仅测试代码要复杂得多。这就是应用程序接口设计的**金科玉律**的作用所在：*为你开发的 API 编写测试是不够的；你必须为使用你的 API 的代码编写单元测试。当你这样做的时候，你就会亲身体会到当你的用户试图独立测试他们的代码时所要克服的障碍。*

没有一种方法能让开发人员轻松测试使用 API 的代码。“static”、“final”和“sealed”本质上并不是坏的构造。它们有时会很有用。但重要的是要意识到测试问题，而要做到这一点，就必须亲身经历。一旦经历过，你就可以像对待其他设计挑战一样对待它。

作者：[Michael Feathers](http://programmer.97things.oreilly.com/wiki/index.php/Michael_Feathers)