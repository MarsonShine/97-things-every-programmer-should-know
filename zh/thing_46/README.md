# 了解你的限制

> *"人必须知道自己的局限性。" - Dirty Harry*

你的资源是有限的。你只有这么多的时间和金钱来完成工作，包括保持知识、技能和工具更新所需的时间和金钱。你只能以一定的努力程度、速度和智慧来工作，并且工作时间也有限。你的工具也只有一定的能力。你的目标机器也只有一定的性能。因此，你必须尊重自己资源的局限性。

如何尊重这些限制呢？了解自己、了解团队、了解预算以及了解自己的工作内容是非常重要的。特别是作为一名软件工程师，你需要了解数据结构和算法的空间和时间复杂度，以及系统的架构和性能特点。你的工作是创建一个最优的软件与系统结合体。

空间和时间复杂度通常用函数 $O(f(n))$ 表示，其中 n 代表输入的大小，当 n 增长到无穷大时，它表示所需的空间或时间。对于$f(n)$，重要的复杂度类包括 ln(n)*、*n*、*n ln(n)*、*n<sup>e</sup>* 和 *e<sup>n</sup>*。通过绘制这些函数的图形可以清楚地看到，当 *n* 变大时，$O(ln(n))$ 比 $O(n)$ 和 $O(n ln(n))$ 小得多，而它们又比 *O(n<sup>e</sup>)* 和 *O(e<sup>n</sup>)* 小得多。正如 Sean Parent 所说，对于可实现的 n，所有复杂度类都可以归结为接近常数、接近线性或接近无限大的复杂度。

![](http://programmer.97things.oreilly.com/wiki/images/c/c0/Clearly.jpeg)

|              | access time      |   capacity |
|--------------|-----------------:| ----------:|
| register     |  < 1 ns          |        64b |
| cache line   |                  |        64B |
| L1 cache     |  1 ns            | 64 KB      |
| L2 cache     |  4 ns            | 8 MB       |
| RAM          | 20 ns            | 32 GB      |
| disk         | 10 ms            | 10 TB      |
| LAN          | 20 ms            | > 1 PB     |
| internet     | 100 ms           | > 1 ZB     |

复杂性分析是以抽象机器为单位的，但软件是在真实机器上运行的。现代计算机系统由物理机和虚拟机组成，包括语言运行时、操作系统、CPU、高速缓冲存储器、随机存取存储器、磁盘驱动器和网络。第一个表格显示了典型网络服务器的随机存取时间和存储容量限制。

请注意，容量和速度相差几个数量级。为了掩盖这种差异，我们在系统的各个层面都大量使用了缓存和前瞻功能，但它们只有在访问是可预测的情况下才能发挥作用。当缓存频繁缺失时，系统就会崩溃。例如，随机检查硬盘上的每个字节可能需要 32 年的时间。即使是随机检查内存中的每个字节，也可能需要 11 分钟。随机存取是不可预测的。什么是可预测的？这取决于系统，但重新访问最近使用过的项目和按顺序访问项目通常是赢家。

算法和数据结构在有效使用缓存方面各不相同。例如
- 线性搜索充分利用了前瞻性，但需要 *O(n)* 次比较。
- 排序数组的二进制搜索只需要 *O(log(n))* 次比较。
- Emde Boas 树的搜索时间为 *O(log(n))*，且不依赖缓存。


|Elements | Search time (ns)|       |         |
|:--------|-----------:|-----------:|--------:|
|         | **linear** | **binary** |	**vEB** |
| 8       | 50         | 90         | 40      |
| 64      | 180        | 150        | 70      |
| 512     | 1200       | 230        | 100     |
| 4096    | 17000      | 320        | 160     |

如何选择？最后的分析就是测量。第二个表格显示了通过这三种方法搜索 64 位整数数组所需的时间。在我的电脑上
- 线性搜索在搜索小数组时具有竞争力，但在搜索大数组时会以指数级的速度递减。
- van Emde Boas 则以其可预测的访问模式胜出。

> *"你付你的钱，你做你的选择。" — [Punch](http://www.nytimes.com/1988/02/28/magazine/on-language-you-pays-yer-money.html?pagewanted=all)*

作者：[Greg Colvin](http://programmer.97things.oreilly.com/wiki/index.php/Greg_Colvin)