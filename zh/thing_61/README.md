# 统一二进制文件

我见过几个项目，在构建过程中会重写代码的某些部分，为每个目标环境生成自定义的二进制文件。这总是会让事情变得更加复杂，并带来团队可能无法在每个安装环境中获得一致版本的风险。这至少需要构建多个近乎相同的软件副本，然后将每个副本部署到正确的位置。这意味着需要更多的活动部件，也就意味着有更多犯错的机会。

我曾在一个团队中工作过，每一次属性更改都必须在整个构建周期中进行检查，因此每当测试人员需要进行细微调整时，他们就只能等待（我有没有提到构建时间也太长了？） 我还曾在一个团队工作过，系统管理员坚持从头开始重建生产版本（使用与我们相同的脚本），这意味着我们无法证明生产版本就是经过测试的版本。诸如此类。

这个规则很简单：**构建一个单一的二进制文件，你可以通过发布流程中的所有阶段进行识别和推进。**将特定于环境的细节保存在环境中。这可能意味着，例如，将它们保存在组件容器中，或者在已知文件中，或者在路径中。

如果你的团队要么进行了代码篡改构建，要么将所有目标设置与代码一起存储，这说明没有人仔细考虑过设计，没有将应用程序的核心功能与平台特定功能区分开来。或者更糟糕的情况是：团队知道该怎么做，但却无法确定做出改变的优先级。

当然，也有例外情况：您可能正在为资源限制大不相同的目标进行构建，但这并不适用于我们大多数正在编写“从数据库到屏幕再返回”应用程序的人。另外，您可能会遇到一些遗留问题，而这些问题现在还很难解决。在这种情况下，你必须循序渐进，但要尽快开始。

还有一点：环境信息也要保持版本化。最糟糕的事情莫过于破坏了环境配置，却不知道改变了什么。环境信息应与代码分开进行版本控制，因为它们的变化速度和原因各不相同。有些团队为此使用分布式版本控制系统（如 bazaar 和 git），因为它们可以更方便地将生产环境中不可避免的变更推送回版本库。

作者：[Steve Freeman](http://programmer.97things.oreilly.com/wiki/index.php/Steve_Freeman)