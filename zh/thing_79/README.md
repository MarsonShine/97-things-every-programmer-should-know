# 利用代码分析工具

测试的价值是软件开发人员从编程初期就开始接受的教育。近年来，随着单元测试、测试驱动开发和敏捷方法的兴起，人们对在开发周期的各个阶段充分利用测试的兴趣大增。然而，测试只是提高代码质量的众多工具之一。

早在 C 语言刚刚兴起的时候，CPU 时间和存储空间都是非常宝贵的。最早的 C 语言编译器意识到了这一点，因此通过删除一些语义分析来减少代码的遍历次数。这意味着编译器只能检查编译时能发现的一小部分错误。为了弥补这一缺陷，斯蒂芬-约翰逊（Stephen Johnson）编写了一款名为*lint*的工具，该工具可以去除代码中的毛刺，并实现了一些从其姊妹 C 编译器中移除的静态分析功能。然而，静态分析工具因给出大量假阳性警告和并非总是有必要遵循的文体习惯警告而声名狼藉。

目前，语言、编译器和静态分析工具的情况已大不相同。现在的内存和 CPU 时间相对便宜，因此编译器有能力检查更多的错误。几乎每种语言都拥有至少一种工具，可以检查违反样式指南的行为、常见的错误，有时还可以检查难以捕捉的狡猾错误，如潜在的空指针取消引用。更复杂的工具（如 C 语言的 Splint 或 Python 语言的 Pylint）是可配置的，这意味着您可以通过配置文件、命令行开关或集成开发环境来选择工具发出的错误和警告。Splint 甚至还能让你在注释中注解代码，以便更好地提示程序如何运行。

如果其他方法都不奏效，而你又发现自己在寻找编译器、集成开发环境或 lint 工具都无法捕捉到的简单 bug 或违反标准的代码，那么你可以自己开发一个静态检查工具。这并不像听起来那么困难。大多数语言，尤其是动态语言，都会将其抽象语法树和编译工具作为标准库的一部分公开。值得了解的是，您所使用的语言的开发团队会使用标准库中的一些角落，因为这些角落往往隐藏着对静态分析和动态测试有用的宝藏。例如，Python 标准库包含一个反汇编器，它能告诉你生成某些编译代码或代码对象所使用的字节码。这听起来像是 python-dev 团队中编译器编写者的一个晦涩难懂的工具，但实际上它在日常情况下的用处大得出奇。这个库可以反汇编你的最后一个堆栈跟踪，让你确切地知道是哪个字节码指令引发了最后一个未捕获异常。

因此，不要让测试成为质量保证的终结--利用分析工具，不要害怕开发自己的工具。

作者：[Sarah Mount](http://programmer.97things.oreilly.com/wiki/index.php/Sarah_Mount)