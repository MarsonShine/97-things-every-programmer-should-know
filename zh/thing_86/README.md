# 两个错误可能会对（且难以修复）

代码从不说谎，但它也会自相矛盾。有些矛盾会让人产生“这怎么可能行得通”的想法。

在一次[访谈](http://www.netjeff.com/humor/item.cgi?file=ApolloComputer)中，阿波罗 11 号登月舱软件的主要设计者艾伦-克鲁姆普（Allan Klumpp）透露，控制发动机的软件包含一个本应使着陆器不稳定的错误。然而，另一个错误弥补了第一个错误，在发现或修复这两个错误之前，阿波罗 11 号和 12 号登月舱都使用了该软件。

考虑一个返回完成状态的函数。想象一下，当它应该返回 true 时却返回了 false。现在想象一下，调用函数忽略了检查返回值。一切都运行正常，直到有一天有人发现缺少检查并将其插入。

或者考虑一个将状态存储为 XML 文档的应用程序。想象一下，其中一个节点被错误地写成了 `TimeToLive`，而不是文档中所说的 `TimeToDie`。在写入代码和读取代码都包含相同错误的情况下，一切看起来都很正常。但如果修复了其中一个错误，或者添加了一个新的应用程序来读取同一个文档，对称性就会被破坏，代码也会被破坏。

当代码中的两个缺陷造成一个可见故障时，有条不紊的故障修复方法本身就会崩溃。开发人员收到错误报告，发现缺陷，修复缺陷，然后重新测试。然而，由于第二个缺陷在起作用，报告的故障仍会发生。因此，开发人员删除了第一个修复程序，检查代码，直到发现第二个潜在缺陷，并对其进行修复。但是，第一个缺陷又出现了，报告的故障仍然存在，因此第二个修复又被退回。这个过程不断重复，但现在开发人员已经否定了两种可能的修复方法，而正在寻找第三种永远不会奏效的修复方法。

两个代码缺陷之间的相互作用看起来就像一个可见的故障，这不仅使问题难以解决，还会让开发人员陷入盲区，最终发现自己一开始就尝试了正确的答案。

这种情况不仅发生在代码中：这个问题也存在于书面需求文档中。它可以从一个地方病毒式地传播到另一个地方。代码中的错误会弥补书面描述中的错误。

它还会传染给人：用户会认为应用程序中的“左”指的是“右”，因此他们会相应地调整自己的行为。他们甚至会把这种错误传递给新用户：“记住，当应用程序说点击左边按钮时，其实是指右边的按钮”。修正错误后，用户突然需要重新培训。

单个错误很容易发现，也很容易修复。而具有多种原因、需要多次修改的问题则更难解决。在某种程度上，正是因为简单的问题很容易解决，所以人们往往会相对较快地解决这些问题，而把更难解决的问题留到以后解决。

对于如何解决共性缺陷引起的故障，没有简单的建议。我们需要意识到这种可能性，头脑清醒，并愿意考虑所有的可能性。

作者：[Allan Kelly](http://programmer.97things.oreilly.com/wiki/index.php/Allan_Kelly)