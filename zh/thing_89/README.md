# 使用正确的算法和数据结构

> 一家拥有许多分支机构的大银行抱怨说，它为出纳员购买的新电脑速度太慢。当时大家还没有使用电子银行业务，自动取款机也不像现在这样普及。人们去银行的频率要高得多，而缓慢的电脑却让人们排起了长队。因此，银行威胁要解除与供应商的合同。

> 供应商派出了一名性能分析和调整专家，以确定造成延迟的原因。他很快发现终端上运行的一个特定程序几乎消耗了所有的 CPU 容量。使用剖析工具，他放大了程序，看到了罪魁祸首的函数。源代码如下

> ```
> for (i=0; i<strlen(s); ++i) {
> if (... s[i] ...) ...
> }
> ```

> 字符串 s 平均有数千个字符。代码（由银行编写）很快就被修改了，银行出纳员从此过上了幸福的生活....。

难道程序员不应该做得更好吗？
每次调用 strlen 都要遍历字符串中的数千个字符，以找到其终止的空字符。然而，字符串从未改变过。如果事先确定了字符串的长度，程序员就可以节省成千上万次对 strlen 的调用（以及数百万次循环执行）：

```
n=strlen(s)；
for (i=0; i<n; ++i) {
  if (... s[i] ...) ...
}
```

每个人都知道“先让它工作，再让它快速工作”的格言，以避免微优化的陷阱。但上面的例子几乎会让你相信，程序员遵循的是马基雅弗利式的格言：“先让它慢慢工作”。

这种漫不经心的做法你可能会遇到不止一次。这不仅仅是“不要重新发明轮子”的问题。有时，程序员新手不假思索就开始敲击键盘，然后突然就“发明”了气泡排序。他们甚至会以此炫耀。

选择正确算法的另一方面是数据结构的选择。这可能会带来很大的不同：与散列数据结构或二叉树相比，使用链表来处理一个包含一百万个要搜索的项目的集合，会对用户对你的编程产生很大的影响。

程序员不应该重新发明轮子，而应该尽可能使用现有的库。但为了避免出现类似银行的问题，程序员还应该了解算法及其扩展方式。现代文本编辑器是否只是为了吸引眼球，才会像 20 世纪 80 年代的 WordStar 等老式程序一样缓慢？许多人说，编程中的重复使用是最重要的。然而，最重要的是，程序员应该知道何时、用什么和如何重复使用。要做到这一点，程序员必须了解问题领域、算法和数据结构。

一名优秀的程序员还应该知道何时使用令人讨厌的算法。举例来说，如果问题领域规定项目永远不能超过五个（就像Yahtzee游戏中的骰子数），那么你就会知道*总是*必须对最多五个项目进行排序。在这种情况下，冒泡排序可能是最有效的排序方法。每条狗都有自己的一天。

所以，多读几本好书吧，一定要读懂它们。如果你真的读懂了唐纳德-克努特（Donald Knuth）的《计算机编程的艺术》（*the Art of Computer Programming*），你甚至会很幸运：找到作者的一个错误，就能获得一张唐纳德-克努斯的十六进制美元（2.56 美元）支票。

作者：[JC van Winkel](http://programmer.97things.oreilly.com/wiki/index.php/JC_van_Winkel)