# 为人编写测试

您正在为部分或全部生产代码编写自动化测试。恭喜您！您在编写代码之前就编写了测试？那就更好了，只要做到这一点，你就是软件工程实践前沿的先行者之一。但是，你的测试写得好吗？如何判断？一种方法是问“我在为谁写测试？”如果答案是“为我自己，让我省去修复错误的精力”或“为编译器，让它们能被执行”，那么你就很可能没有写出最好的测试。那么你应该为*谁*编写测试呢？为试图理解你的代码的人。

好的测试是测试代码的文档。它们描述了代码是如何工作的。对于每种使用场景，测试都要做到

1. 描述上下文、起点或必须满足的前提条件
2. 说明如何调用软件
3. 描述预期结果或需要验证的后置条件

不同的使用场景会有略微不同的版本。试图理解您的代码的人应该能够查看一些测试，并通过比较相关测试的这三个部分，了解是什么导致了软件的不同行为。每个测试都应清楚地说明这三个部分之间的因果关系。这意味着测试中不可见的东西与可见的东西同样重要。测试中过多的代码会用不重要的琐事分散读者的注意力。尽可能将这些琐事隐藏在有意义的方法调用之后——提取方法重构是你最好的朋友。确保给每个测试都起一个有意义的名字，以描述特定的使用场景，这样测试读者就不必对每个测试进行逆向工程，就能理解各种场景是什么。在它们之间，测试类和类方法的名称至少应包括软件的起点和调用方式。这样就可以通过快速扫描方法名称来验证测试覆盖率。在测试方法名称中包含预期结果也是有用的，只要这样做不会导致名称过长，难以查看或阅读。

测试你的测试也是一个好主意。您可以通过在生产代码（当然是您自己的私人副本，您会把它扔掉）中插入这些错误来验证它们是否能检测到您认为它们能检测到的错误。确保它们能以有用和有意义的方式报告错误。您还应该验证您的测试是否能让试图理解您代码的人清楚地理解。要做到这一点，唯一的办法就是让不熟悉你的代码的人阅读你的测试，并告诉你他们学到了什么。仔细听他们说什么。如果他们没有清楚地理解某些内容，可能并不是因为他们不聪明。更有可能的原因是你说得不太清楚。(来吧，把角色反过来，读他们的测试！）。

作者：[Gerard Meszaros](http://programmer.97things.oreilly.com/wiki/index.php/Gerard_Meszaros)